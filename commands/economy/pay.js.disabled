const balance = require('../../models/economy');
const { Client, Message } = require('discord.js');

module.exports = {
    name: 'pay',
    aliases: ['give', 'lend'],
    description: 'Cho ngÆ°á»i khÃ¡c tiá»n cá»§a báº¡n',
    /**
     * 
     * @param {Client} client 
     * @param {Message} message 
     * @param {String} args 
     */
    run: async(client, message, args) => {
        if (!args[0]) return message.channel.send(`Báº¡n pháº£i chá»‰ Ä‘á»‹nh ngÆ°á»i Ä‘á»ƒ Ä‘Æ°a tiá»n`);
        if (!args[1] || isNaN(args[1])) return message.channel.send(`Báº¡n pháº£i chá»‰ Ä‘á»‹nh sá»‘ tiá»n Ä‘Æ°a ra, hoáº·c sá»‘ tiá»n chá»‰ Ä‘á»‹nh khÃ´ng há»£p lá»‡`);
        const givenUser = message.mentions.members.first();
        if (!givenUser) return message.channel.send(`Báº¡n cáº§n Ä‘Æ°a ra ngÆ°á»i há»£p lá»‡!`)
        const amountofMoney = parseInt(args[1]);
        if (amountofMoney > 20000) return message.channel.send(`Báº¡n Ä‘ang Ä‘Æ°a ra sá»‘ tiá»n quÃ¡ lá»›n, bot chá»‰ chuyá»ƒn Ä‘Æ°á»£c \`$20,000\` tiá»n tá»‘i Ä‘a`);

        const giver = await client.balance(message.author.id);
        const given = await client.balance(givenUser.id);
        
        if (giver.money < amountofMoney) return message.channel.send(`Báº¡n khÃ´ng Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh sá»‘ tiá»n quÃ¡ lá»›n so vá»›i tÃ i khoáº£n cá»§a mÃ¬nh`);

        try {
            balance.findOneAndUpdate({ userId: giver.id }, { $inc: { money: -1 * amountofMoney } });
            balance.findOneAndUpdate({ userId: given.id }, { $inc: { money: 1 * amountofMoney } }); 
            message.channel.send(`ğŸ’³ **${message.author.username}** Ä‘Ã£ chuyá»ƒn thÃ nh cÃ´ng cho **${givenUser.displayName}** sá»‘ tiá»n lÃ  **${amountofMoney}**`)   
        } catch(e) {
            message.channel.send(`${client.emoji.danger} Oops! CÃ³ váº» Ä‘Ã£ cÃ³ trá»¥c tráº·c khi Ä‘ang chuyá»ƒn tiá»n`);
            console.log(e);
        }
    }
}